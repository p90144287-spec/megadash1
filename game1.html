<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculation Balloon Game</title>
<meta name="description" content="Pop balloons by solving math problems! Enter the correct answer to match the floating balloons. Improves calculation speed and memory.">
<meta name="keywords" content="balloon math game, brain game, calculation game, online math game, number challenge, mental math">

<meta property="og:title" content="Balloon Calculation Game | Brain Math Challenge">
<meta property="og:description" content="Pop floating balloons by solving math problems. Boost calculation speed and focus while having fun!">
<meta property="og:type" content="game">
<meta property="og:url" content="https://yourwebsite.com/balloon-calculation.html">
<meta property="og:image" content="https://yourwebsite.com/balloon-preview.png">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Balloon Calculation Game">
<meta name="twitter:description" content="Pop balloons by solving math problems and train your brain!">
<meta name="twitter:image" content="https://yourwebsite.com/balloon-preview.png">

<link rel="icon" href="icon.jpg" sizes="32x32" type="image/png">

<style>
* {
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  margin: 0;
  background: linear-gradient(to bottom, #87ceeb, #e6f7ff);
  height: 100vh;
  overflow: hidden;
}

#topBar {
  position: fixed;
  top: 0;
  width: 100%;
  padding: 10px;
  display: flex;
  justify-content: space-between;
  background: rgba(255,255,255,0.85);
  z-index: 10;
}

#score {
  font-weight: 600;
}

#inputBox {
  width: 90px;
  padding: 6px;
  font-size: 16px;
  border-radius: 8px;
  border: 2px solid #4facfe;
  text-align: center;
}

#gameArea {
  position: relative;
  width: 100%;
  height: 100%;
}

.balloon {
  position: absolute;
  background: radial-gradient(circle at 30% 30%, #fff, #ff6f91);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 16px;
}

.balloon::after {
  content: "";
  position: absolute;
  bottom: -20px;
  width: 2px;
  height: 20px;
  background: #444;
}

.explode {
  animation: pop 0.3s forwards;
}

@keyframes pop {
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

#gameOver {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
}

#gameOverBox {
  background: #fff;
  padding: 25px;
  border-radius: 16px;
  text-align: center;
  width: 80%;
  max-width: 300px;
}

#gameOverBox button {
  margin-top: 15px;
  padding: 10px 18px;
  border: none;
  border-radius: 10px;
  background: #4facfe;
  font-weight: 600;
  font-size: 16px;
}
</style>
</head>

<body>

<div id="topBar">
  <div id="score">Score: 0</div>
  <input id="inputBox" type="number" placeholder="Ans">
</div>

<div id="gameArea"></div>

<div id="gameOver"> 
  <div id="gameOverBox">
    <h2>Game Over</h2>
    <p id="finalScore"></p>
    <p id="highScore" style="color: #4facfe; font-weight: bold;"></p> 
    <button onclick="restartGame()">Restart</button>
  </div>
</div>



<!-- Sounds -->
<audio id="popSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_1c7c54d2d8.mp3"></audio>
<audio id="gameOverSound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_93b09c8c6f.mp3"></audio>
<audio id="restartSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_61b02bbd7d.mp3"></audio>

<script>
const gameArea = document.getElementById("gameArea");
const inputBox = document.getElementById("inputBox");
const scoreEl = document.getElementById("score");
const gameOverScreen = document.getElementById("gameOver");
const finalScoreEl = document.getElementById("finalScore");

const popSound = document.getElementById("popSound");
const gameOverSound = document.getElementById("gameOverSound");
const restartSound = document.getElementById("restartSound");

let score = 0;
let speed = 1.2;
let balloonSize = 70;
let spawnDelay = 2500;
let minSpawnDelay = 900;
let gameRunning = true;
let balloons = [];
let spawnTimer = null;

function rand(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function createExpression() {
  let a = rand(1, 10);
  let b = rand(1, 10);
  let ops = ["+", "-", "*"];
  let op = ops[rand(0, ops.length - 1)];
  let result;

  // 1. Calculate the actual result first
  if (op === "+") result = a + b;
  if (op === "-") result = a - b;
  if (op === "*") result = a * b;

  // 2. Randomly choose between Normal mode and Missing Number mode
  // Only do missing numbers if score is > 5 to let the player warm up
  let isMissingMode = score > 5 && Math.random() > 0.5;

  if (isMissingMode) {
    // Format: "a + ? = result"
    // The player must type 'b' to win
    return { 
      text: `${a} ${op} ? = ${result}`, 
      value: b 
    };
  } else {
    // Normal Format: "a + b"
    // The player must type 'result' to win
    return { 
      text: `${a}${op}${b}`, 
      value: result 
    };
  }
}



function createBalloon() {
  if (!gameRunning) return;

  const balloon = document.createElement("div");
  balloon.className = "balloon";

  const exp = createExpression();
  balloon.innerText = exp.text;
  balloon.dataset.value = exp.value;
  balloon.dataset.alive = "true";

  balloon.style.width = balloonSize + "px";
  balloon.style.height = (balloonSize + 20) + "px";
  balloon.style.left = rand(10, window.innerWidth - balloonSize - 10) + "px";
  balloon.style.top = "-100px";

  gameArea.appendChild(balloon);
  balloons.push(balloon);

  let y = -100;

  function fall() {
    if (!gameRunning || balloon.dataset.alive === "false") return;
    y += speed;
    balloon.style.top = y + "px";

    if (y > window.innerHeight) {
      endGame();
    } else {
      requestAnimationFrame(fall);
    }
  }
  fall();
}

function checkAnswer() {
  const val = parseInt(inputBox.value);
  if (isNaN(val)) return;

  for (let i = balloons.length - 1; i >= 0; i--) {
    const balloon = balloons[i];
    if (parseInt(balloon.dataset.value) === val) {
      balloon.dataset.alive = "false";
      balloon.classList.add("explode");
      popSound.currentTime = 0;
      popSound.play();
      setTimeout(() => balloon.remove(), 300);
      balloons.splice(i, 1);
      score++;
      scoreEl.innerText = "Score: " + score;
      inputBox.value = "";
      break;
    }
  }
}

function endGame() {
  if (!gameRunning) return;
  gameRunning = false;
  clearTimeout(spawnTimer);
  gameOverSound.play();

  // 1. Get the current High Score from storage (default to 0 if none exists)
  let savedHighScore = localStorage.getItem("balloonHighScore") || 0;

  // 2. Compare and save if the current score is better
  if (score > savedHighScore) {
    localStorage.setItem("balloonHighScore", score);
    savedHighScore = score; // Update variable for the display
    document.getElementById("highScore").innerText = "New Record! ðŸ†";
  } else {
    document.getElementById("highScore").innerText = "Best: " + savedHighScore;
  }

  gameOverScreen.style.display = "flex";
  finalScoreEl.innerText = "Your Score: " + score;
}


function restartGame() {
  restartSound.play();
  score = 0;
  speed = 1.2;
  balloonSize = 70;
  spawnDelay = 2500;
  balloons = [];
  gameRunning = true;
  scoreEl.innerText = "Score: 0";
  gameArea.innerHTML = "";
  inputBox.value = "";
  gameOverScreen.style.display = "none";
  startSpawning();
}

inputBox.addEventListener("input", checkAnswer);

// Smooth difficulty over time
setInterval(() => {
  if (!gameRunning) return;
  if (speed < 4) speed += 0.05;
  if (balloonSize > 45) balloonSize -= 1;
  if (spawnDelay > minSpawnDelay) spawnDelay -= 150;
}, 10000);

// Controlled balloon spawning
function startSpawning() {
  if (!gameRunning) return;
  createBalloon();
  spawnTimer = setTimeout(startSpawning, spawnDelay);
}

startSpawning();
</script>

</body>
</html>
